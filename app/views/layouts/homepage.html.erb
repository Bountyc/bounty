<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon" href="../../favicon.ico">
  	<title>Bountyc</title>
  <%= Gon::Base.render_data %>

  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css">

  <% if not user_signed_in? %>
    <link rel="stylesheet" href="//releases.flowplayer.org/6.0.4/skin/minimalist.css" >
    <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="//releases.flowplayer.org/6.0.4/flowplayer.min.js"></script>
  <% end %>

	<%= javascript_include_tag 'application', 'showdown' => true, 'data-turbolinks-track' => true %>
  	<%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  	<%= csrf_meta_tags %>
</head>
<body>
<%= render "layouts/notice" %>
<% if user_signed_in? %>
  <%= render "layouts/header" %>
    <script type="text/javascript">
    var pusher = new Pusher("<%= PUSHER_KEY %>");
    var userChannel = pusher.subscribe("private-user-<%= current_user.id %>");
    userChannel.bind('new-notification', function(message) {
      var count_notifications = parseInt($("#notifications-count").text())+1;
      $("#notifications-count").html(count_notifications);
      if (!$("#notifications-count").is(":visible"))
      {
        $("#notifications-count").show("slow")
      }
      $("#notifications").prepend(message);
    });
    $(document).ready(function() {
      $( "#dLabel" ).click(function() {
        // make ajax request to server to notify that notifications where viewed
        $.ajax({
          type: "POST",
          url: '<%= see_notifications_path %>',
          data: { _method:'PUT' },
          success: function(msg) {
            $( "#notifications-count" ).hide();
            // reset notifications count
            $("#notifications-count").html("0")
          }
        });

      });
    });
    </script>
<% else %>
  <%= render "layouts/logged_out_homepage_header" %>
<% end %>
<%= yield %>

<%= javascript_include_tag 'bootstrap.min', 'data-turbolinks-track' => true %>
</body>
</html>
